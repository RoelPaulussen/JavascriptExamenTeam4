<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    

</head>
<body>
    
    <script>
        //api url
        const api_url = "https://randomuser.me/api/?results=10";
        //async function in order to get the data
        async function getapi(url){
            
            try{
                const response = await fetch(url);
                const data = await response.json();
                show(data);
            }
            catch (error){
                console.log(error);
            }
        }

        getapi(api_url);

        //show data within cards
        function show(data){
            console.log(data);
            let  placeholder = document.getElementById('placeholder');
            let a, b = 0, d=1000000000;
            
            //this is to make a new card for each result within the api
            for(let result of data.results){
                placeholder.innerHTML += 
                `
                <div class="col tagged" id="newCard">
                    <div class="card" style="width: 18rem;">
                        <img src="${result.picture.medium}" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">${result.name.first}</h5>
                            <p class="card-text"><b id="PC">${result.location.postcode}</b> </p>
                        </div>
                    </div>
                </div>
                `
                console.log(Math.max(result.location.postcode))
                a = result.location.postcode;
                if(!isNaN(a)){
                    if(a>b){
                        b=a;
                    }
                    if(a<d){
                        d=a;
                    }
                }
            }
            document.getElementById("priceRange").min = d;
            document.getElementById("priceRange").max = b;
            document.getElementById("priceRange").value = b;
            document.getElementById("pricemin").value = d;
            document.getElementById("pricemax").value = b;
        }
        //search function that looks for any letter/combination that has been inputted
        function searchfilter(){
            let input,inputPrice, filter, a, b, i, txtvalue, cards, divcol, pricevalue;
            inputPrice = document.getElementById("priceRange");
            input = document.getElementById("inputsearch");
            filter = input.value.toUpperCase(); 
            divcol = document.getElementById("placeholder");
            cards = divcol.getElementsByClassName("tagged")
            //console.log(divcol)
            //console.log(cards.length + cards);


            //this will update the price selected by the user
            document.getElementById("curPrice").value = inputPrice.value;

            //turns on or off what needs to be visible/invisible
            for(i=0; i < cards.length; i++){
                //this is to get the text out in order to compare
                a = cards[i].getElementsByTagName("h5")[0];
                txtvalue = a.textContent || a.innerText;
                //this is to get the pricevalue out and convert it to a number
                b = cards[i].getElementsByTagName("b")[0];
                pricevalue = parseInt(b.textContent) || parseInt(b.innerText);

                if(txtvalue.toUpperCase().indexOf(filter) > -1 && pricevalue <= inputPrice.value){
                    cards[i].style.display = "";
                    if(isNaN(pricevalue)){
                        cards[i].style.display = "";
                    }
                }
                else{
                    cards[i].style.display = "none";
                    
                    
                }
            }
        }
    </script>

    <!-- search field -->
    <div>
        <input type="text" id="inputsearch" onkeyup="searchfilter()">
        Min
        <output id="pricemin">Min0</output>
        <input type="range" id="priceRange" min="0" max="0" oninput="searchfilter()">
        Max
        <output id="pricemax">0</output>
        <br>
        <output id="curPrice">0</output>
    </div>

    <!-- This is where the data goes to and spawns into cards -->
    <div class="container">
        <div class="row" id="placeholder">
            <!-- Ready to receive the async juice -->
        </div>
    </div>

</body>
</html>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>